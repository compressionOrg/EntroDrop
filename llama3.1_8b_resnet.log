(grasp) zhangyingying@tesla-a40-1:~/cyl/prune/test/ShortGPT/GRASP-base$ bash run_rm_layers_resnet.sh  >>llama3.1_8b_resnet.log      
bash: /home/zhangyingying/anaconda3/envs/hgn3/lib/libtinfo.so.6: no version information available (required by bash)
+ set -e
+ layers_order=29,30,28,27,24,16,14,25,13,20,21,19,23,17,22,26,15,9,7,12,4,6,1,3,5,11,0,8,2,10,18,31
+ for num_prune in 4 8 12 16
+ echo 'Running with num_prune=4'
+ python run_rm_layers.py --layers_to_remove 29,30,28,27,24,16,14,25,13,20,21,19,23,17,22,26,15,9,7,12,4,6,1,3,5,11,0,8,2,10,18,31 -
-num_prune 4
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████| 4/4 [00:06<00:00,  1.62s/it]
2025-07-20 08:16:03,090 - evaluate_grasp - INFO - load dataset wikitext2
Token indices sequence length is longer than the specified maximum sequence length for this model (289077 > 131072). Running this se
quence through the model will result in indexing errors
100%|█████████████████████████████████████████████████████████████████████████████████████████████| 141/141 [00:47<00:00,  3.00it/s]
2025-07-20 08:16:51,115 - evaluate_grasp - INFO - wikitext2 137.94395446777344
2025-07-20 08:16:51,116 - evaluate_grasp - INFO - load dataset ptb
100%|███████████████████████████████████████████████████████████████████████████████████████████████| 42/42 [00:14<00:00,  2.95it/s]
2025-07-20 08:17:05,646 - evaluate_grasp - INFO - ptb 189.48817443847656
  0%|                                                                                                     | 0/83947 [00:00<?, ?it/s]
Starting from v4.46, the `logits` model output will have the same type as the model (except at train time, where it will always be F
P32)
100%|███████████████████████████████████████████████████████████████████████████████████████| 83947/83947 [1:49:04<00:00, 12.83it/s]
2025-07-20 10:07:42,850 - evaluate_grasp - INFO - {'wikitext2': 137.94395446777344, 'ptb': 189.48817443847656, 'mathqa': {'acc': 0.3
3668341708542715, 'acc_stderr': 0.008651110935825696, 'acc_norm': 0.34472361809045227, 'acc_norm_stderr': 0.008700583267963934}, 'pi
qa': {'acc': 0.6343852013057671, 'acc_stderr': 0.011236571679006276, 'acc_norm': 0.6343852013057671, 'acc_norm_stderr': 0.0112365716
79006276}, 'hellaswag': {'acc': 0.3088030272854013, 'acc_stderr': 0.00461055497441124, 'acc_norm': 0.367257518422625, 'acc_norm_stde
rr': 0.004810723108378219}, 'winogrande': {'acc': np.float64(0.5919494869771112), 'acc_stderr': 0.013812822643745028}, 'arc_easy': {
'acc': 0.43223905723905726, 'acc_stderr': 0.010165130379698753, 'acc_norm': 0.4318181818181818, 'acc_norm_stderr': 0.010163945352271
725}, 'arc_challenge': {'acc': 0.310580204778157, 'acc_stderr': 0.013522292098053059, 'acc_norm': 0.33532423208191126, 'acc_norm_std
err': 0.013796182947785566}, 'openbookqa': {'acc': 0.274, 'acc_stderr': 0.019966103540279452, 'acc_norm': 0.392, 'acc_norm_stderr': 0.02185468495561126}, 'boolq': {'acc': 0.6039755351681957, 'acc_stderr': 0.008553881336813417}, 'mean': np.float64(0.4365769912298896)}
2025-07-20 10:07:42,852 - evaluate_grasp - INFO -

===== mean acc: 0.4365769912298896 =====

+ python run_rm_layers.py --layers_to_remove 29,30,28,27,24,16,14,25,13,20,21,19,23,17,22,26,15,9,7,12,4,6,1,3,5,11,0,8,2,10,18,31 -
-num_prune 8
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████| 4/4 [00:06<00:00,  1.67s/it]
2025-07-20 10:07:57,436 - evaluate_grasp - INFO - load dataset wikitext2
Token indices sequence length is longer than the specified maximum sequence length for this model (289077 > 131072). Running this se
quence through the model will result in indexing errors
100%|█████████████████████████████████████████████████████████████████████████████████████████████| 141/141 [01:34<00:00,  1.49it/s]
2025-07-20 10:09:33,362 - evaluate_grasp - INFO - wikitext2 392.7971496582031
2025-07-20 10:09:33,362 - evaluate_grasp - INFO - load dataset ptb
100%|███████████████████████████████████████████████████████████████████████████████████████████████| 42/42 [00:28<00:00,  1.49it/s]
2025-07-20 10:10:01,846 - evaluate_grasp - INFO - ptb 423.6163330078125 
  0%|                                                                                                     | 0/83947 [00:00<?, ?it/s]Starting from v4.46, the `logits` model output will have the same type as the model (except at train time, where it will always be FP32)
100%|███████████████████████████████████████████████████████████████████████████████████████| 83947/83947 [1:40:45<00:00, 13.89it/s]
2025-07-20 11:52:38,186 - evaluate_grasp - INFO - {'wikitext2': 392.7971496582031, 'ptb': 423.6163330078125, 'mathqa': {'acc': 0.2613065326633166, 'acc_stderr': 0.008042810817625763, 'acc_norm': 0.2606365159128978, 'acc_norm_stderr': 0.008036134931668057}, 'piqa': {'acc': 0.6120783460282916, 'acc_stderr': 0.011368965300027381, 'acc_norm': 0.6142546245919478, 'acc_norm_stderr': 0.011357166777524042}, 'hellaswag': {'acc': 0.28599880501892055, 'acc_stderr': 0.004509652679395692, 'acc_norm': 0.3291177056363274, 'acc_norm_stderr': 0.004689324696186876}, 'winogrande': {'acc': np.float64(0.5651144435674822), 'acc_stderr': 0.013932814110418029}, 'arc_easy': {'acc': 0.38173400673400676, 'acc_stderr': 0.00996864885183967, 'acc_norm': 0.38215488215488214, 'acc_norm_stderr': 0.009970747281292448}, 'arc_challenge': {'acc': 0.25, 'acc_stderr': 0.012653835621466646, 'acc_norm': 0.28924914675767915, 'acc_norm_stderr': 0.013250012579393443}, 'openbookqa': {'acc': 0.24, 'acc_stderr': 0.01911886665375974, 'acc_norm': 0.336, 'acc_norm_stderr': 0.021144791425048843}, 'boolq': {'acc': 0.6220183486238532, 'acc_stderr': 0.008480656964585245}, 'mean': np.float64(0.4022813103294839)}
2025-07-20 11:52:38,188 - evaluate_grasp - INFO -

===== mean acc: 0.4022813103294839 =====

+ echo 'Running with num_prune=12'
+ python run_rm_layers.py --layers_to_remove 29,30,28,27,24,16,14,25,13,20,21,19,23,17,22,26,15,9,7,12,4,6,1,3,5,11,0,8,2,10,18,31 -
-num_prune 12
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████| 4/4 [00:06<00:00,  1.63s/it]
2025-07-20 11:52:51,234 - evaluate_grasp - INFO - load dataset wikitext2
Token indices sequence length is longer than the specified maximum sequence length for this model (289077 > 131072). Running this se
quence through the model will result in indexing errors
100%|█████████████████████████████████████████████████████████████████████████████████████████████| 141/141 [01:35<00:00,  1.48it/s]
2025-07-20 11:54:27,468 - evaluate_grasp - INFO - wikitext2 9500.53515625
2025-07-20 11:54:27,468 - evaluate_grasp - INFO - load dataset ptb
100%|███████████████████████████████████████████████████████████████████████████████████████████████| 42/42 [00:27<00:00,  1.55it/s]
2025-07-20 11:54:54,831 - evaluate_grasp - INFO - ptb 2842.86328125
  0%|                                                                                                     | 0/83947 [00:00<?, ?it/s]
Starting from v4.46, the `logits` model output will have the same type as the model (except at train time, where it will always be F
P32)
100%|███████████████████████████████████████████████████████████████████████████████████████| 83947/83947 [1:46:54<00:00, 13.09it/s]
2025-07-20 13:43:49,180 - evaluate_grasp - INFO - {'wikitext2': 9500.53515625, 'ptb': 2842.86328125, 'mathqa': {'acc': 0.23383584589
61474, 'acc_stderr': 0.0077484894980075075, 'acc_norm': 0.23618090452261306, 'acc_norm_stderr': 0.007775319378747051}, 'piqa': {'acc
': 0.5919477693144722, 'acc_stderr': 0.011466872778651264, 'acc_norm': 0.5794341675734495, 'acc_norm_stderr': 0.011517665611282774},
 'hellaswag': {'acc': 0.2927703644692292, 'acc_stderr': 0.004541039698729829, 'acc_norm': 0.34773949412467636, 'acc_norm_stderr': 0.
004752794829825042}, 'winogrande': {'acc': np.float64(0.5540647198105761), 'acc_stderr': 0.013970093482330699}, 'arc_easy': {'acc': 
0.36447811447811446, 'acc_stderr': 0.009875729282482438, 'acc_norm': 0.359006734006734, 'acc_norm_stderr': 0.009843424713072176}, 'a
rc_challenge': {'acc': 0.24232081911262798, 'acc_stderr': 0.012521593295800116, 'acc_norm': 0.2781569965870307, 'acc_norm_stderr': 0
.0130944699195388}, 'openbookqa': {'acc': 0.204, 'acc_stderr': 0.01803936910413867, 'acc_norm': 0.328, 'acc_norm_stderr': 0.02101702
7165175495}, 'boolq': {'acc': 0.6244648318042814, 'acc_stderr': 0.008469774334938068}, 'mean': np.float64(0.38848530811068105)}
2025-07-20 13:43:49,181 - evaluate_grasp - INFO -

===== mean acc: 0.38848530811068105 =====

+ echo 'Running with num_prune=16'
+ python run_rm_layers.py --layers_to_remove 29,30,28,27,24,16,14,25,13,20,21,19,23,17,22,26,15,9,7,12,4,6,1,3,5,11,0,8,2,10,18,31 --num_prune 16
Loading checkpoint shards: 100%|██████████████████████████████████████████████████████████████████████| 4/4 [00:06<00:00,  1.71s/it]
2025-07-20 13:44:03,611 - evaluate_grasp - INFO - load dataset wikitext2
Token indices sequence length is longer than the specified maximum sequence length for this model (289077 > 131072). Running this sequence through the model will result in indexing errors
100%|█████████████████████████████████████████████████████████████████████████████████████████████| 141/141 [02:18<00:00,  1.02it/s]
2025-07-20 13:46:22,838 - evaluate_grasp - INFO - wikitext2 4826.7880859375
2025-07-20 13:46:22,839 - evaluate_grasp - INFO - load dataset ptb
100%|███████████████████████████████████████████████████████████████████████████████████████████████| 42/42 [00:38<00:00,  1.08it/s]
2025-07-20 13:47:02,028 - evaluate_grasp - INFO - ptb 2985.67529296875  
  0%|                                                                                                     | 0/83947 [00:00<?, ?it/s]Starting from v4.46, the `logits` model output will have the same type as the model (except at train time, where it will always be FP32)
100%|███████████████████████████████████████████████████████████████████████████████████████| 83947/83947 [1:41:37<00:00, 13.77it/s]
2025-07-20 15:30:41,985 - evaluate_grasp - INFO - {'wikitext2': 4826.7880859375, 'ptb': 2985.67529296875, 'mathqa': {'acc': 0.20804020100502513, 'acc_stderr': 0.007430632646805398, 'acc_norm': 0.2100502512562814, 'acc_norm_stderr': 0.007456961930598774}, 'piqa': {'acc': 0.5478781284004353, 'acc_stderr': 0.011612217507379625, 'acc_norm': 0.515233949945593, 'acc_norm_stderr': 0.011660408257153634}, 'hellaswag': {'acc': 0.2719577773351922, 'acc_stderr': 0.004440588618232715, 'acc_norm': 0.2927703644692292, 'acc_norm_stderr': 0.004541039698729836}, 'winogrande': {'acc': np.float64(0.5343330702446725), 'acc_stderr': 0.014019317531542558}, 'arc_easy': {'acc': 0.31734006734006737, 'acc_stderr': 0.00955064834394777, 'acc_norm': 0.30808080808080807, 'acc_norm_stderr': 0.009473887075826332}, 'arc_challenge': {'acc': 0.23890784982935154, 'acc_stderr': 0.012461071376316621, 'acc_norm': 0.2721843003412969, 'acc_norm_stderr': 0.013006600406423707}, 'openbookqa': {'acc': 0.174, 'acc_stderr': 0.016971271257516147, 'acc_norm': 0.278, 'acc_norm_stderr': 0.02005583388807091}, 'boolq': {'acc': 0.6305810397553517, 'acc_stderr': 0.008441557531799617}, 'mean': np.float64(0.36537976673876194)}
2025-07-20 15:30:41,986 - evaluate_grasp - INFO -

===== mean acc: 0.36537976673876194 =====s2025-07-22 17:24:21,186 - __main__ - INFO - Loading model: meta-llama/Llama-3.1-8B
2025-07-22 17:24:29,542 - __main__ - INFO - Layers order: 29,30,28,27,24,16,14,25,13,20,21,19,23,17,22,26,15,9,7,12,4,6,1,3,5,11,0,8,2,10,18,31
2025-07-22 17:24:29,542 - __main__ - INFO - Num prune: 10
2025-07-22 17:24:29,543 - __main__ - INFO - Layers to remove: [29, 30, 28, 27, 24, 16, 14, 25, 13, 20]
2025-07-22 17:24:29,543 - __main__ - INFO - ====================================================================================================
2025-07-22 17:24:29,544 - evaluate_grasp - INFO - load dataset wikitext2
2025-07-22 17:25:07,857 - evaluate_grasp - INFO - wikitext2 564.9518432617188
2025-07-22 17:25:07,858 - evaluate_grasp - INFO - load dataset ptb
2025-07-22 17:25:19,468 - evaluate_grasp - INFO - ptb 379.9393005371094
2025-07-22 18:42:05,159 - evaluate_grasp - INFO - {'wikitext2': 564.9518432617188, 'ptb': 379.9393005371094, 'mathqa': {'acc': 0.2284757118927973, 'acc_stderr': 0.007685912066383918, 'acc_norm': 0.22646566164154103, 'acc_norm_stderr': 0.007661989801224791}, 'piqa': {'acc': 0.6158868335146899, 'acc_stderr': 0.011348160741479143, 'acc_norm': 0.6050054406964092, 'acc_norm_stderr': 0.011405665187969038}, 'hellaswag': {'acc': 0.29944234216291576, 'acc_stderr': 0.004570777326263893, 'acc_norm': 0.35022903804023103, 'acc_norm_stderr': 0.0047606663111463}, 'winogrande': {'acc': np.float64(0.5935280189423836), 'acc_stderr': 0.013804448697753375}, 'arc_easy': {'acc': 0.3733164983164983, 'acc_stderr': 0.009925009142802883, 'acc_norm': 0.3686868686868687, 'acc_norm_stderr': 0.009899640855681045}, 'arc_challenge': {'acc': 0.24232081911262798, 'acc_stderr': 0.012521593295800116, 'acc_norm': 0.28754266211604096, 'acc_norm_stderr': 0.01322671905626613}, 'openbookqa': {'acc': 0.218, 'acc_stderr': 0.018483378223178838, 'acc_norm': 0.344, 'acc_norm_stderr': 0.02126575803797874}, 'boolq': {'acc': 0.6211009174311927, 'acc_stderr': 0.008484678718565017}, 'mean': np.float64(0.39900889267163814)}
2025-07-22 18:42:05,161 - evaluate_grasp - INFO - 

===== mean acc: 0.39900889267163814 =====


2025-07-22 18:42:09,224 - __main__ - INFO - Loading model: meta-llama/Llama-3.1-8B
2025-07-22 18:42:17,768 - __main__ - INFO - Layers order: 29,30,28,27,24,16,14,25,13,20,21,19,23,17,22,26,15,9,7,12,4,6,1,3,5,11,0,8,2,10,18,31
2025-07-22 18:42:17,769 - __main__ - INFO - Num prune: 14
2025-07-22 18:42:17,769 - __main__ - INFO - Layers to remove: [29, 30, 28, 27, 24, 16, 14, 25, 13, 20, 21, 19, 23, 17]
2025-07-22 18:42:17,769 - __main__ - INFO - ====================================================================================================
2025-07-22 18:42:17,771 - evaluate_grasp - INFO - load dataset wikitext2
2025-07-22 18:43:43,183 - evaluate_grasp - INFO - wikitext2 13850.4072265625
2025-07-22 18:43:43,184 - evaluate_grasp - INFO - load dataset ptb
2025-07-22 18:44:07,422 - evaluate_grasp - INFO - ptb 2112.243896484375
2025-07-22 19:51:12,900 - evaluate_grasp - INFO - {'wikitext2': 13850.4072265625, 'ptb': 2112.243896484375, 'mathqa': {'acc': 0.2154103852596315, 'acc_stderr': 0.007525843570103341, 'acc_norm': 0.2067001675041876, 'acc_norm_stderr': 0.007412926365358842}, 'piqa': {'acc': 0.5919477693144722, 'acc_stderr': 0.011466872778651266, 'acc_norm': 0.5767138193688792, 'acc_norm_stderr': 0.011527699473614478}, 'hellaswag': {'acc': 0.3029277036446923, 'acc_stderr': 0.00458585083562358, 'acc_norm': 0.37562238597888864, 'acc_norm_stderr': 0.004832934529120797}, 'winogrande': {'acc': np.float64(0.5477505919494869), 'acc_stderr': 0.01398825621660601}, 'arc_easy': {'acc': 0.36153198653198654, 'acc_stderr': 0.009858506543162063, 'acc_norm': 0.34595959595959597, 'acc_norm_stderr': 0.00976074962442751}, 'arc_challenge': {'acc': 0.2380546075085324, 'acc_stderr': 0.012445770028026205, 'acc_norm': 0.2687713310580205, 'acc_norm_stderr': 0.012955065963710688}, 'openbookqa': {'acc': 0.184, 'acc_stderr': 0.01734617478175285, 'acc_norm': 0.312, 'acc_norm_stderr': 0.02074059653648809}, 'boolq': {'acc': 0.6247706422018349, 'acc_stderr': 0.008468397820914278}, 'mean': np.float64(0.38329921080132956)}
2025-07-22 19:51:12,901 - evaluate_grasp - INFO - 

===== mean acc: 0.38329921080132956 =====


